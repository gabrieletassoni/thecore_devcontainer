#!/bin/bash -e

function yes_or_no {
    while true; do
        read -p "$* [y/n]: " yn
        case $yn in
            [Yy]*) return 0  ;;  
            [Nn]*) echo "Aborted" ; return  1 ;;
        esac
    done
}

DOCKERUSER=gabrieletassoni
DOCKERVERSION=$(date +"%Y%m%d")
DOCKERTAG="$DOCKERUSER/thecore"

docker build -f Dockerfile.common -t "${DOCKERTAG}:latest" -t "${DOCKERTAG}:${DOCKERVERSION}" .
echo "$DOCKERTAG"

if yes_or_no "Would you like to push this image to the docker hub?"
then
    echo "Login to docker hub"
    docker login
    [[ "$DOCKERTAG" ]] && docker push --all-tags "$DOCKERTAG"
else
    exit 1
fi

exit 0