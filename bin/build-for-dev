#!/bin/bash -e

DOCKERVERSION=$(date +"%Y%m%d")
echo "New Version: $DOCKERVERSION"
git add . -A
git commit -a -m "New Version $DOCKERVERSION"
git push origin ":refs/tags/$DOCKERVERSION"
git tag -fa "$DOCKERVERSION"
git push
git push --tags
DOCKERUSER=gabrieletassoni
DOCKERTAG=$DOCKERUSER/vscode-devcontainers-thecore

docker build --no-cache --pull -f Dockerfile.common -f Dockerfile.development -t "${DOCKERTAG}:latest" -t "${DOCKERTAG}:${DOCKERVERSION}" .
echo "$DOCKERTAG"

echo "Login to docker hub"
docker login
[[ "$DOCKERTAG" ]] && docker push "$DOCKERTAG"

exit 0